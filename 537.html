<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p537" style="overflow: hidden; position: relative; background-color: white; width: 770px; height: 1010px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_537{left:118px;bottom:907px;letter-spacing:0.01px;}
#t2_537{left:137px;bottom:907px;letter-spacing:0.01px;}
#t3_537{left:137px;bottom:888px;letter-spacing:-0.01px;word-spacing:0.03px;}
#t4_537{left:110px;bottom:852px;letter-spacing:0.02px;}
#t5_537{left:139px;bottom:853px;letter-spacing:0.12px;}
#t6_537{left:196px;bottom:852px;letter-spacing:0.01px;word-spacing:0.3px;}
#t7_537{left:110px;bottom:832px;letter-spacing:0.02px;word-spacing:1.43px;}
#t8_537{left:330px;bottom:833px;letter-spacing:0.12px;}
#t9_537{left:381px;bottom:832px;letter-spacing:0.02px;word-spacing:1.43px;}
#ta_537{left:462px;bottom:833px;letter-spacing:0.12px;}
#tb_537{left:505px;bottom:832px;letter-spacing:0.02px;word-spacing:1.43px;}
#tc_537{left:110px;bottom:812px;letter-spacing:0.12px;}
#td_537{left:163px;bottom:812px;letter-spacing:-0.02px;word-spacing:0.39px;}
#te_537{left:589px;bottom:812px;letter-spacing:-0.02px;word-spacing:0.04px;}
#tf_537{left:110px;bottom:793px;word-spacing:0.02px;}
#tg_537{left:110px;bottom:763px;letter-spacing:-0.3px;word-spacing:0.92px;}
#th_537{left:199px;bottom:764px;letter-spacing:0.12px;}
#ti_537{left:257px;bottom:763px;letter-spacing:0.02px;word-spacing:0.61px;}
#tj_537{left:479px;bottom:764px;letter-spacing:0.12px;}
#tk_537{left:529px;bottom:763px;letter-spacing:0.05px;word-spacing:0.58px;}
#tl_537{left:110px;bottom:744px;letter-spacing:-0.03px;word-spacing:0.04px;}
#tm_537{left:136px;bottom:718px;letter-spacing:-0.01px;}
#tn_537{left:168px;bottom:718px;}
#to_537{left:175px;bottom:718px;letter-spacing:-0.01px;}
#tp_537{left:305px;bottom:718px;}
#tq_537{left:389px;bottom:718px;letter-spacing:-0.01px;}
#tr_537{left:162px;bottom:703px;}
#ts_537{left:168px;bottom:703px;letter-spacing:-0.01px;}
#tt_537{left:194px;bottom:703px;}
#tu_537{left:201px;bottom:703px;letter-spacing:-0.01px;}
#tv_537{left:259px;bottom:703px;}
#tw_537{left:279px;bottom:703px;letter-spacing:-0.01px;}
#tx_537{left:331px;bottom:703px;}
#ty_537{left:337px;bottom:703px;letter-spacing:-0.01px;}
#tz_537{left:363px;bottom:703px;letter-spacing:-0.01px;}
#t10_537{left:389px;bottom:703px;letter-spacing:-0.01px;}
#t11_537{left:162px;bottom:687px;}
#t12_537{left:168px;bottom:687px;letter-spacing:-0.01px;}
#t13_537{left:194px;bottom:687px;}
#t14_537{left:201px;bottom:687px;letter-spacing:-0.01px;}
#t15_537{left:279px;bottom:687px;}
#t16_537{left:298px;bottom:687px;}
#t17_537{left:389px;bottom:687px;letter-spacing:-0.01px;}
#t18_537{left:188px;bottom:672px;letter-spacing:-0.01px;}
#t19_537{left:285px;bottom:672px;}
#t1a_537{left:292px;bottom:672px;letter-spacing:-0.01px;}
#t1b_537{left:363px;bottom:672px;letter-spacing:-0.01px;}
#t1c_537{left:162px;bottom:656px;letter-spacing:-0.01px;}
#t1d_537{left:110px;bottom:628px;letter-spacing:-0.07px;word-spacing:2.18px;}
#t1e_537{left:378px;bottom:628px;letter-spacing:0.12px;}
#t1f_537{left:422px;bottom:628px;letter-spacing:0.02px;}
#t1g_537{left:452px;bottom:628px;letter-spacing:0.12px;}
#t1h_537{left:496px;bottom:628px;word-spacing:2.11px;}
#t1i_537{left:110px;bottom:609px;letter-spacing:0.01px;word-spacing:0.01px;}
#t1j_537{left:136px;bottom:583px;letter-spacing:-0.01px;}
#t1k_537{left:175px;bottom:583px;letter-spacing:-0.01px;}
#t1l_537{left:233px;bottom:583px;letter-spacing:-0.01px;}
#t1m_537{left:324px;bottom:583px;letter-spacing:-0.01px;}
#t1n_537{left:162px;bottom:567px;letter-spacing:-0.01px;}
#t1o_537{left:188px;bottom:567px;letter-spacing:-0.01px;}
#t1p_537{left:246px;bottom:567px;}
#t1q_537{left:259px;bottom:567px;letter-spacing:-0.01px;}
#t1r_537{left:331px;bottom:567px;}
#t1s_537{left:337px;bottom:567px;letter-spacing:-0.01px;}
#t1t_537{left:474px;bottom:567px;letter-spacing:-0.01px;}
#t1u_537{left:162px;bottom:552px;letter-spacing:-0.01px;}
#t1v_537{left:188px;bottom:552px;letter-spacing:-0.01px;}
#t1w_537{left:220px;bottom:552px;}
#t1x_537{left:233px;bottom:552px;letter-spacing:-0.01px;}
#t1y_537{left:324px;bottom:552px;}
#t1z_537{left:331px;bottom:552px;letter-spacing:-0.01px;}
#t20_537{left:357px;bottom:552px;letter-spacing:-0.01px;}
#t21_537{left:162px;bottom:536px;letter-spacing:-0.01px;}
#t22_537{left:207px;bottom:536px;letter-spacing:-0.01px;}
#t23_537{left:240px;bottom:536px;letter-spacing:-0.01px;}
#t24_537{left:266px;bottom:536px;letter-spacing:-0.01px;}
#t25_537{left:311px;bottom:536px;}
#t26_537{left:136px;bottom:520px;}
#t27_537{left:110px;bottom:493px;letter-spacing:0.01px;word-spacing:0.57px;}
#t28_537{left:110px;bottom:473px;letter-spacing:0.02px;word-spacing:1.55px;}
#t29_537{left:221px;bottom:473px;letter-spacing:0.12px;}
#t2a_537{left:280px;bottom:473px;word-spacing:1.56px;}
#t2b_537{left:110px;bottom:454px;word-spacing:0.39px;}
#t2c_537{left:110px;bottom:434px;letter-spacing:0.02px;}
#t2d_537{left:286px;bottom:378px;letter-spacing:-0.03px;}
#t2e_537{left:123px;bottom:355px;letter-spacing:0.11px;}
#t2f_537{left:153px;bottom:355px;letter-spacing:-0.24px;}
#t2g_537{left:210px;bottom:355px;letter-spacing:0.12px;word-spacing:2.61px;}
#t2h_537{left:123px;bottom:337px;letter-spacing:0.08px;word-spacing:0.28px;}
#t2i_537{left:123px;bottom:318px;letter-spacing:0.1px;word-spacing:1.25px;}
#t2j_537{left:123px;bottom:300px;letter-spacing:0.08px;word-spacing:2.25px;}
#t2k_537{left:123px;bottom:282px;letter-spacing:0.08px;word-spacing:0.22px;}
#t2l_537{left:346px;bottom:282px;letter-spacing:0.1px;}
#t2m_537{left:393px;bottom:282px;letter-spacing:0.03px;word-spacing:0.27px;}
#t2n_537{left:123px;bottom:263px;letter-spacing:0.08px;word-spacing:0.04px;}
#t2o_537{left:110px;bottom:207px;letter-spacing:-0.11px;}
#t2p_537{left:110px;bottom:180px;letter-spacing:0.02px;word-spacing:3.23px;}
#t2q_537{left:214px;bottom:181px;letter-spacing:0.12px;}
#t2r_537{left:274px;bottom:180px;letter-spacing:0.02px;word-spacing:3.23px;}
#t2s_537{left:398px;bottom:180px;letter-spacing:0.02px;}
#t2t_537{left:458px;bottom:180px;word-spacing:3.24px;}
#t2u_537{left:110px;bottom:161px;letter-spacing:-0.09px;word-spacing:0.11px;}
#t2v_537{left:136px;bottom:135px;letter-spacing:-0.01px;}
#t2w_537{left:168px;bottom:135px;}
#t2x_537{left:175px;bottom:135px;letter-spacing:-0.01px;}
#t2y_537{left:305px;bottom:135px;}
#t2z_537{left:331px;bottom:135px;letter-spacing:-0.01px;}
#t30_537{left:162px;bottom:120px;}
#t31_537{left:168px;bottom:120px;letter-spacing:-0.01px;}
#t32_537{left:194px;bottom:120px;}
#t33_537{left:201px;bottom:120px;letter-spacing:-0.01px;}
#t34_537{left:259px;bottom:120px;}
#t35_537{left:279px;bottom:120px;}
#t36_537{left:331px;bottom:120px;letter-spacing:-0.01px;}
#t37_537{left:188px;bottom:104px;letter-spacing:-0.01px;}
#t38_537{left:207px;bottom:104px;}
#t39_537{left:214px;bottom:104px;letter-spacing:-0.01px;}
#t3a_537{left:266px;bottom:104px;}
#t3b_537{left:272px;bottom:104px;}
#t3c_537{left:292px;bottom:104px;}
#t3d_537{left:331px;bottom:104px;letter-spacing:-0.01px;}
#t3e_537{left:532px;bottom:59px;letter-spacing:-0.09px;}
#t3f_537{left:627px;bottom:59px;}
#t3g_537{left:643px;bottom:59px;letter-spacing:-0.1px;}

.s1_537{font-size:16px;font-family:MinionPro-Regular_7yv;color:#000;}
.s2_537{font-size:15px;font-family:UbuntuMono-Regular_7zr;color:#000;}
.s3_537{font-size:16px;font-family:MinionPro-Regular_7yv;color:#900;}
.s4_537{font-size:13px;font-family:UbuntuMono-Regular_7zr;color:#008;}
.s5_537{font-size:13px;font-family:UbuntuMono-Regular_7zr;color:#000;}
.s6_537{font-size:13px;font-family:UbuntuMono-Regular_7zr;color:#C30;}
.s7_537{font-size:13px;font-family:UbuntuMono-Italic_7zm;color:#35586C;}
.s8_537{font-size:13px;font-family:UbuntuMono-Regular_7zr;color:#555;}
.s9_537{font-size:13px;font-family:UbuntuMono-Bold_7zh;color:#069;}
.sa_537{font-size:23px;font-family:MyriadPro-SemiboldCond_7yc;color:#000;}
.sb_537{font-size:15px;font-family:MinionPro-Regular_7yv;color:#000;}
.sc_537{font-size:15px;font-family:MinionPro-Regular_7yv;color:#900;}
.sd_537{font-size:18px;font-family:MyriadPro-SemiboldCond_7yc;color:#000;}
.se_537{font-size:14px;font-family:MyriadPro-SemiboldCond_7yc;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts537" type="text/css" >

@font-face {
	font-family: MinionPro-Regular_7yv;
	src: url("fonts/MinionPro-Regular_7yv.woff") format("woff");
}

@font-face {
	font-family: MyriadPro-SemiboldCond_7yc;
	src: url("fonts/MyriadPro-SemiboldCond_7yc.woff") format("woff");
}

@font-face {
	font-family: UbuntuMono-Bold_7zh;
	src: url("fonts/UbuntuMono-Bold_7zh.woff") format("woff");
}

@font-face {
	font-family: UbuntuMono-Italic_7zm;
	src: url("fonts/UbuntuMono-Italic_7zm.woff") format("woff");
}

@font-face {
	font-family: UbuntuMono-Regular_7zr;
	src: url("fonts/UbuntuMono-Regular_7zr.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg537Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg537" style="-webkit-user-select: none;"><svg id="pdf537" width="770" height="1010" viewBox="0 0 770 1010" style="width:770px; height:1010px; -moz-transform:scale(1); z-index: 0; isolation: isolate;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<defs>
<clipPath id="c0_537"><path d="M110,930.3v-4.7H660v4.7Z"/></clipPath>
<clipPath id="c1_537"><path d="M111.3,592.2l-1.2,-2.3l-1.2,-2.4H661.1l-1.2,2.4l-1.2,2.3Z"/></clipPath>
<clipPath id="c2_537"><path d="M662.2,763.9l-2.4,-1.2l-2.3,-1.2V590.9l2.3,-1.1l2.4,-1.2V763.9Z"/></clipPath>
<clipPath id="c3_537"><path d="M108.9,764.9l1.2,-2.3l1.2,-2.4H658.7l1.2,2.4l1.2,2.3Z"/></clipPath>
<clipPath id="c4_537"><path d="M107.8,763.9V588.6l2.4,1.2l2.3,1.1V761.5l-2.3,1.2l-2.4,1.2Z"/></clipPath>
<style type="text/css"><![CDATA[
.g0_537{
fill: none;
stroke: #000;
stroke-width: 0.381;
stroke-linecap: round;
stroke-miterlimit: 10;
}
]]></style>
</defs>
<path clip-path="url(#c0_537)" d="M660,927.9H110" class="g0_537"/>
<path clip-path="url(#c1_537)" d="M110,589.9H660" class="g0_537"/>
<path clip-path="url(#c2_537)" d="M659.8,589.7V762.8" class="g0_537"/>
<path clip-path="url(#c3_537)" d="M660,762.6H110" class="g0_537"/>
<path clip-path="url(#c4_537)" d="M110.2,762.8V589.7" class="g0_537"/>
</svg></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_537" class="t s1_537">3. </span><span id="t2_537" class="t s1_537">Get the body object that is asynchronously returned by step 2 and process it how‐ </span>
<span id="t3_537" class="t s1_537">ever you want. </span>
<span id="t4_537" class="t s1_537">The </span><span id="t5_537" class="t s2_537">fetch() </span><span id="t6_537" class="t s1_537">API is completely Promise-based, and there are two asynchronous steps </span>
<span id="t7_537" class="t s1_537">here, so you typically expect two </span><span id="t8_537" class="t s2_537">then() </span><span id="t9_537" class="t s1_537">calls or two </span><span id="ta_537" class="t s2_537">await </span><span id="tb_537" class="t s1_537">expressions when using </span>
<span id="tc_537" class="t s2_537">fetch()</span><span id="td_537" class="t s1_537">. (And if you’ve forgotten what those are, you may want to reread </span><span id="te_537" class="t s3_537">Chapter 13 </span>
<span id="tf_537" class="t s1_537">before continuing with this section.) </span>
<span id="tg_537" class="t s1_537">Here’s what a </span><span id="th_537" class="t s2_537">fetch() </span><span id="ti_537" class="t s1_537">request looks like if you are using </span><span id="tj_537" class="t s2_537">then() </span><span id="tk_537" class="t s1_537">and expect the serv‐ </span>
<span id="tl_537" class="t s1_537">er’s response to your request to be JSON-formatted: </span>
<span id="tm_537" class="t s4_537">fetch</span><span id="tn_537" class="t s5_537">(</span><span id="to_537" class="t s6_537">"/api/users/current"</span><span id="tp_537" class="t s5_537">) </span><span id="tq_537" class="t s7_537">// Make an HTTP (or HTTPS) GET request </span>
<span id="tr_537" class="t s5_537">.</span><span id="ts_537" class="t s4_537">then</span><span id="tt_537" class="t s5_537">(</span><span id="tu_537" class="t s4_537">response </span><span id="tv_537" class="t s8_537">=&gt; </span><span id="tw_537" class="t s4_537">response</span><span id="tx_537" class="t s5_537">.</span><span id="ty_537" class="t s4_537">json</span><span id="tz_537" class="t s5_537">()) </span><span id="t10_537" class="t s7_537">// Parse its body as a JSON object </span>
<span id="t11_537" class="t s5_537">.</span><span id="t12_537" class="t s4_537">then</span><span id="t13_537" class="t s5_537">(</span><span id="t14_537" class="t s4_537">currentUser </span><span id="t15_537" class="t s8_537">=&gt; </span><span id="t16_537" class="t s5_537">{ </span><span id="t17_537" class="t s7_537">// Then process that parsed object </span>
<span id="t18_537" class="t s4_537">displayUserInfo</span><span id="t19_537" class="t s5_537">(</span><span id="t1a_537" class="t s4_537">currentUser</span><span id="t1b_537" class="t s5_537">); </span>
<span id="t1c_537" class="t s5_537">}); </span>
<span id="t1d_537" class="t s1_537">Here’s a similar request made using the </span><span id="t1e_537" class="t s2_537">async </span><span id="t1f_537" class="t s1_537">and </span><span id="t1g_537" class="t s2_537">await </span><span id="t1h_537" class="t s1_537">keywords to an API that </span>
<span id="t1i_537" class="t s1_537">returns a plain string rather than a JSON object: </span>
<span id="t1j_537" class="t s4_537">async </span><span id="t1k_537" class="t s9_537">function </span><span id="t1l_537" class="t s4_537">isServiceReady</span><span id="t1m_537" class="t s5_537">() { </span>
<span id="t1n_537" class="t s9_537">let </span><span id="t1o_537" class="t s4_537">response </span><span id="t1p_537" class="t s8_537">= </span><span id="t1q_537" class="t s4_537">await fetch</span><span id="t1r_537" class="t s5_537">(</span><span id="t1s_537" class="t s6_537">"/api/service/status"</span><span id="t1t_537" class="t s5_537">); </span>
<span id="t1u_537" class="t s9_537">let </span><span id="t1v_537" class="t s4_537">body </span><span id="t1w_537" class="t s8_537">= </span><span id="t1x_537" class="t s4_537">await response</span><span id="t1y_537" class="t s5_537">.</span><span id="t1z_537" class="t s4_537">text</span><span id="t20_537" class="t s5_537">(); </span>
<span id="t21_537" class="t s9_537">return </span><span id="t22_537" class="t s4_537">body </span><span id="t23_537" class="t s8_537">=== </span><span id="t24_537" class="t s6_537">"ready"</span><span id="t25_537" class="t s5_537">; </span>
<span id="t26_537" class="t s5_537">} </span>
<span id="t27_537" class="t s1_537">If you understand these two code examples, then you know 80% of what you need to </span>
<span id="t28_537" class="t s1_537">know to use the </span><span id="t29_537" class="t s2_537">fetch() </span><span id="t2a_537" class="t s1_537">API. The subsections that follow will demonstrate how to </span>
<span id="t2b_537" class="t s1_537">make requests and receive responses that are somewhat more complicated than those </span>
<span id="t2c_537" class="t s1_537">shown here. </span>
<span id="t2d_537" class="t sa_537">Goodbye XMLHttpRequest </span>
<span id="t2e_537" class="t sb_537">The </span><span id="t2f_537" class="t s2_537">fetch() </span><span id="t2g_537" class="t sb_537">API replaces the baroque and misleadingly named XMLHttpRequest </span>
<span id="t2h_537" class="t sb_537">API (which has nothing to do with XML). You may still see XHR (as it is often abbre‐ </span>
<span id="t2i_537" class="t sb_537">viated) in existing code, but there is no reason today to use it in new code, and it is </span>
<span id="t2j_537" class="t sb_537">not documented in this chapter. There is one example of XMLHttpRequest in this </span>
<span id="t2k_537" class="t sb_537">book, however, and you can refer to </span><span id="t2l_537" class="t sc_537">§13.1.3 </span><span id="t2m_537" class="t sb_537">if you’d like to see an example of old-style </span>
<span id="t2n_537" class="t sb_537">JavaScript networking. </span>
<span id="t2o_537" class="t sd_537">HTTP status codes, response headers, and network errors </span>
<span id="t2p_537" class="t s1_537">The three-step </span><span id="t2q_537" class="t s2_537">fetch() </span><span id="t2r_537" class="t s1_537">process shown in </span><span id="t2s_537" class="t s3_537">§15.11.1 </span><span id="t2t_537" class="t s1_537">elides all error-handling code. </span>
<span id="t2u_537" class="t s1_537">Here’s a more realistic version: </span>
<span id="t2v_537" class="t s4_537">fetch</span><span id="t2w_537" class="t s5_537">(</span><span id="t2x_537" class="t s6_537">"/api/users/current"</span><span id="t2y_537" class="t s5_537">) </span><span id="t2z_537" class="t s7_537">// Make an HTTP (or HTTPS) GET request. </span>
<span id="t30_537" class="t s5_537">.</span><span id="t31_537" class="t s4_537">then</span><span id="t32_537" class="t s5_537">(</span><span id="t33_537" class="t s4_537">response </span><span id="t34_537" class="t s8_537">=&gt; </span><span id="t35_537" class="t s5_537">{ </span><span id="t36_537" class="t s7_537">// When we get a response, first check it </span>
<span id="t37_537" class="t s9_537">if </span><span id="t38_537" class="t s5_537">(</span><span id="t39_537" class="t s4_537">response</span><span id="t3a_537" class="t s5_537">.</span><span id="t3b_537" class="t s4_537">ok </span><span id="t3c_537" class="t s8_537">&amp;&amp; </span><span id="t3d_537" class="t s7_537">// for a success code and the expected type. </span>
<span id="t3e_537" class="t se_537">15.11 Networking </span><span id="t3f_537" class="t se_537">| </span><span id="t3g_537" class="t se_537">519 </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
