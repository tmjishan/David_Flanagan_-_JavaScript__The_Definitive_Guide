<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p548" style="overflow: hidden; position: relative; background-color: white; width: 770px; height: 1010px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_548{left:136px;bottom:910px;letter-spacing:-0.01px;}
#t2_548{left:214px;bottom:910px;letter-spacing:-0.01px;}
#t3_548{left:214px;bottom:894px;letter-spacing:-0.01px;}
#t4_548{left:110px;bottom:867px;letter-spacing:0.01px;word-spacing:1.89px;}
#t5_548{left:110px;bottom:847px;letter-spacing:0.01px;word-spacing:2.91px;}
#t6_548{left:110px;bottom:828px;word-spacing:0.16px;}
#t7_548{left:110px;bottom:809px;letter-spacing:-0.01px;word-spacing:0.03px;}
#t8_548{left:110px;bottom:781px;letter-spacing:-0.01px;word-spacing:2.36px;}
#t9_548{left:110px;bottom:760px;letter-spacing:-0.03px;word-spacing:1.26px;}
#ta_548{left:348px;bottom:761px;letter-spacing:0.12px;}
#tb_548{left:406px;bottom:760px;letter-spacing:0.01px;word-spacing:1.23px;}
#tc_548{left:110px;bottom:741px;word-spacing:0.02px;}
#td_548{left:509px;bottom:741px;letter-spacing:-0.01px;word-spacing:0.03px;}
#te_548{left:609px;bottom:741px;letter-spacing:0.02px;}
#tf_548{left:110px;bottom:722px;letter-spacing:-0.01px;word-spacing:0.03px;}
#tg_548{left:110px;bottom:679px;letter-spacing:-0.09px;word-spacing:0.11px;}
#th_548{left:110px;bottom:648px;letter-spacing:-0.01px;}
#ti_548{left:110px;bottom:633px;letter-spacing:-0.01px;}
#tj_548{left:110px;bottom:617px;letter-spacing:-0.01px;}
#tk_548{left:110px;bottom:601px;letter-spacing:-0.01px;}
#tl_548{left:110px;bottom:586px;letter-spacing:-0.01px;}
#tm_548{left:110px;bottom:570px;letter-spacing:-0.01px;}
#tn_548{left:110px;bottom:555px;letter-spacing:-0.01px;}
#to_548{left:110px;bottom:539px;letter-spacing:-0.01px;}
#tp_548{left:110px;bottom:524px;letter-spacing:-0.01px;}
#tq_548{left:409px;bottom:524px;letter-spacing:-0.01px;}
#tr_548{left:110px;bottom:508px;letter-spacing:-0.01px;}
#ts_548{left:110px;bottom:492px;letter-spacing:-0.01px;}
#tt_548{left:409px;bottom:492px;letter-spacing:-0.01px;}
#tu_548{left:110px;bottom:461px;letter-spacing:-0.01px;}
#tv_548{left:110px;bottom:446px;letter-spacing:-0.01px;}
#tw_548{left:110px;bottom:430px;letter-spacing:-0.01px;}
#tx_548{left:383px;bottom:430px;letter-spacing:-0.01px;}
#ty_548{left:136px;bottom:414px;letter-spacing:-0.01px;}
#tz_548{left:409px;bottom:414px;letter-spacing:-0.01px;}
#t10_548{left:136px;bottom:399px;letter-spacing:-0.01px;}
#t11_548{left:409px;bottom:399px;letter-spacing:-0.01px;}
#t12_548{left:136px;bottom:383px;letter-spacing:-0.01px;}
#t13_548{left:409px;bottom:383px;letter-spacing:-0.01px;}
#t14_548{left:136px;bottom:368px;letter-spacing:-0.01px;}
#t15_548{left:409px;bottom:368px;letter-spacing:-0.01px;}
#t16_548{left:110px;bottom:352px;letter-spacing:-0.01px;}
#t17_548{left:110px;bottom:321px;letter-spacing:-0.01px;}
#t18_548{left:110px;bottom:305px;letter-spacing:-0.01px;}
#t19_548{left:370px;bottom:305px;letter-spacing:-0.01px;}
#t1a_548{left:136px;bottom:290px;letter-spacing:-0.01px;}
#t1b_548{left:370px;bottom:290px;letter-spacing:-0.01px;}
#t1c_548{left:162px;bottom:274px;letter-spacing:-0.01px;}
#t1d_548{left:370px;bottom:274px;letter-spacing:-0.01px;}
#t1e_548{left:162px;bottom:259px;letter-spacing:-0.01px;}
#t1f_548{left:136px;bottom:243px;letter-spacing:-0.01px;}
#t1g_548{left:136px;bottom:227px;letter-spacing:-0.01px;}
#t1h_548{left:370px;bottom:227px;letter-spacing:-0.01px;}
#t1i_548{left:136px;bottom:212px;letter-spacing:-0.01px;}
#t1j_548{left:370px;bottom:212px;letter-spacing:-0.01px;}
#t1k_548{left:110px;bottom:196px;letter-spacing:-0.01px;}
#t1l_548{left:110px;bottom:181px;letter-spacing:-0.01px;}
#t1m_548{left:110px;bottom:165px;letter-spacing:-0.01px;}
#t1n_548{left:110px;bottom:150px;letter-spacing:-0.01px;}
#t1o_548{left:110px;bottom:59px;letter-spacing:-0.08px;}
#t1p_548{left:141px;bottom:59px;}
#t1q_548{left:157px;bottom:59px;letter-spacing:-0.08px;}

.s1_548{font-size:13px;font-family:UbuntuMono-Regular_7zr;color:#000;}
.s2_548{font-size:16px;font-family:MinionPro-Regular_7yv;color:#000;}
.s3_548{font-size:15px;font-family:UbuntuMono-Regular_7zr;color:#000;}
.s4_548{font-size:16px;font-family:MinionPro-Regular_7yv;color:#900;}
.s5_548{font-size:16px;font-family:MinionPro-It_7xz;color:#000;}
.s6_548{font-size:14px;font-family:MyriadPro-SemiboldCond_7yc;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts548" type="text/css" >

@font-face {
	font-family: MinionPro-It_7xz;
	src: url("fonts/MinionPro-It_7xz.woff") format("woff");
}

@font-face {
	font-family: MinionPro-Regular_7yv;
	src: url("fonts/MinionPro-Regular_7yv.woff") format("woff");
}

@font-face {
	font-family: MyriadPro-SemiboldCond_7yc;
	src: url("fonts/MyriadPro-SemiboldCond_7yc.woff") format("woff");
}

@font-face {
	font-family: UbuntuMono-Regular_7zr;
	src: url("fonts/UbuntuMono-Regular_7zr.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg548Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg548" style="-webkit-user-select: none;"><svg id="pdf548" width="770" height="1010" viewBox="0 0 770 1010" style="width:770px; height:1010px; -moz-transform:scale(1); z-index: 0; isolation: isolate;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<defs>
<clipPath id="c0_548"><path d="M110,930.3v-4.7H660v4.7Z"/></clipPath>
<style type="text/css"><![CDATA[
.g0_548{
fill: none;
stroke: #000;
stroke-width: 0.381;
stroke-linecap: round;
stroke-miterlimit: 10;
}
]]></style>
</defs>
<path clip-path="url(#c0_548)" d="M660,927.9H110" class="g0_548"/>
</svg></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_548" class="t s1_548">data: 999 </span><span id="t2_548" class="t s1_548">// appends a newline and more data </span>
<span id="t3_548" class="t s1_548">// a blank line marks the end of the event </span>
<span id="t4_548" class="t s2_548">There are some additional details to the protocol that allow events to be given IDs </span>
<span id="t5_548" class="t s2_548">and allow a reconnecting client to tell the server what the ID of the last event it </span>
<span id="t6_548" class="t s2_548">received was, so that a server can resend any events it missed. Those details are invisi‐ </span>
<span id="t7_548" class="t s2_548">ble on the client side, however, and are not discussed here. </span>
<span id="t8_548" class="t s2_548">One obvious application for Server-Sent Events is for multiuser collaborations like </span>
<span id="t9_548" class="t s2_548">online chat. A chat client might use </span><span id="ta_548" class="t s3_548">fetch() </span><span id="tb_548" class="t s2_548">to post messages to the chat room and </span>
<span id="tc_548" class="t s2_548">subscribe to the stream of chatter with an EventSource object. </span><span id="td_548" class="t s4_548">Example 15-11 </span><span id="te_548" class="t s2_548">demon‐ </span>
<span id="tf_548" class="t s2_548">strates how easy it is to write a chat client like this with EventSource. </span>
<span id="tg_548" class="t s5_548">Example 15-11. A simple chat client using EventSource </span>
<span id="th_548" class="t s1_548">&lt;html&gt; </span>
<span id="ti_548" class="t s1_548">&lt;head&gt;&lt;title&gt;SSE Chat&lt;/title&gt;&lt;/head&gt; </span>
<span id="tj_548" class="t s1_548">&lt;body&gt; </span>
<span id="tk_548" class="t s1_548">&lt;!-- The chat UI is just a single text input field --&gt; </span>
<span id="tl_548" class="t s1_548">&lt;!-- New chat messages will be inserted before this input field --&gt; </span>
<span id="tm_548" class="t s1_548">&lt;input id="input" style="width:100%; padding:10px; border:solid black 2px"/&gt; </span>
<span id="tn_548" class="t s1_548">&lt;script&gt; </span>
<span id="to_548" class="t s1_548">// Take care of some UI details </span>
<span id="tp_548" class="t s1_548">let nick = prompt("Enter your nickname"); </span><span id="tq_548" class="t s1_548">// Get user's nickname </span>
<span id="tr_548" class="t s1_548">let input = document.getElementById("input"); // Find the input field </span>
<span id="ts_548" class="t s1_548">input.focus(); </span><span id="tt_548" class="t s1_548">// Set keyboard focus </span>
<span id="tu_548" class="t s1_548">// Register for notification of new messages using EventSource </span>
<span id="tv_548" class="t s1_548">let chat = new EventSource("/chat"); </span>
<span id="tw_548" class="t s1_548">chat.addEventListener("chat", event =&gt; { </span><span id="tx_548" class="t s1_548">// When a chat message arrives </span>
<span id="ty_548" class="t s1_548">let div = document.createElement("div"); </span><span id="tz_548" class="t s1_548">// Create a &lt;div&gt; </span>
<span id="t10_548" class="t s1_548">div.append(event.data); </span><span id="t11_548" class="t s1_548">// Add text from the message </span>
<span id="t12_548" class="t s1_548">input.before(div); </span><span id="t13_548" class="t s1_548">// And add div before input </span>
<span id="t14_548" class="t s1_548">input.scrollIntoView(); </span><span id="t15_548" class="t s1_548">// Ensure input elt is visible </span>
<span id="t16_548" class="t s1_548">}); </span>
<span id="t17_548" class="t s1_548">// Post the user's messages to the server using fetch </span>
<span id="t18_548" class="t s1_548">input.addEventListener("change", ()=&gt;{ </span><span id="t19_548" class="t s1_548">// When the user strikes return </span>
<span id="t1a_548" class="t s1_548">fetch("/chat", { </span><span id="t1b_548" class="t s1_548">// Start an HTTP request to this url. </span>
<span id="t1c_548" class="t s1_548">method: "POST", </span><span id="t1d_548" class="t s1_548">// Make it a POST request with body </span>
<span id="t1e_548" class="t s1_548">body: nick + ": " + input.value // set to the user's nick and input. </span>
<span id="t1f_548" class="t s1_548">}) </span>
<span id="t1g_548" class="t s1_548">.catch(e =&gt; console.error); </span><span id="t1h_548" class="t s1_548">// Ignore response, but log any errors. </span>
<span id="t1i_548" class="t s1_548">input.value = ""; </span><span id="t1j_548" class="t s1_548">// Clear the input </span>
<span id="t1k_548" class="t s1_548">}); </span>
<span id="t1l_548" class="t s1_548">&lt;/script&gt; </span>
<span id="t1m_548" class="t s1_548">&lt;/body&gt; </span>
<span id="t1n_548" class="t s1_548">&lt;/html&gt; </span>
<span id="t1o_548" class="t s6_548">530 </span><span id="t1p_548" class="t s6_548">| </span><span id="t1q_548" class="t s6_548">Chapter 15: JavaScript in Web Browsers </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
