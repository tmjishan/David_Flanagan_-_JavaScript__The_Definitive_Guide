<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p644" style="overflow: hidden; position: relative; background-color: white; width: 770px; height: 1010px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_644{left:112px;bottom:141px;}
#t2_644{left:122px;bottom:140px;letter-spacing:0.07px;word-spacing:0.01px;}
#t3_644{left:122px;bottom:123px;letter-spacing:0.07px;word-spacing:0.02px;}
#t4_644{left:574px;bottom:124px;letter-spacing:-0.19px;}
#t5_644{left:612px;bottom:123px;letter-spacing:0.1px;}
#t6_644{left:122px;bottom:108px;letter-spacing:0.08px;word-spacing:0.01px;}
#t7_644{left:123px;bottom:907px;}
#t8_644{left:137px;bottom:907px;letter-spacing:-0.02px;word-spacing:2.12px;}
#t9_644{left:138px;bottom:888px;letter-spacing:0.01px;word-spacing:0.63px;}
#ta_644{left:137px;bottom:869px;letter-spacing:0.01px;word-spacing:0.49px;}
#tb_644{left:138px;bottom:849px;letter-spacing:0.02px;word-spacing:0.77px;}
#tc_644{left:138px;bottom:830px;word-spacing:1.53px;}
#td_644{left:137px;bottom:811px;word-spacing:1.42px;}
#te_644{left:138px;bottom:792px;letter-spacing:0.02px;}
#tf_644{left:138px;bottom:772px;letter-spacing:0.01px;word-spacing:0.36px;}
#tg_644{left:137px;bottom:753px;letter-spacing:0.02px;word-spacing:2.23px;}
#th_644{left:138px;bottom:734px;letter-spacing:-0.01px;word-spacing:3.46px;}
#ti_644{left:137px;bottom:715px;letter-spacing:0.02px;word-spacing:0.67px;}
#tj_644{left:138px;bottom:695px;letter-spacing:0.02px;word-spacing:0.26px;}
#tk_644{left:138px;bottom:676px;letter-spacing:0.01px;word-spacing:0.01px;}
#tl_644{left:123px;bottom:651px;}
#tm_644{left:137px;bottom:651px;letter-spacing:0.01px;word-spacing:1.09px;}
#tn_644{left:138px;bottom:631px;letter-spacing:0.01px;word-spacing:0.49px;}
#to_644{left:137px;bottom:612px;word-spacing:1.02px;}
#tp_644{left:138px;bottom:593px;word-spacing:0.01px;}
#tq_644{left:110px;bottom:558px;letter-spacing:-0.01px;word-spacing:2.46px;}
#tr_644{left:110px;bottom:539px;letter-spacing:-0.01px;word-spacing:1.04px;}
#ts_644{left:110px;bottom:520px;letter-spacing:0.01px;word-spacing:2.9px;}
#tt_644{left:110px;bottom:501px;letter-spacing:0.01px;word-spacing:2.06px;}
#tu_644{left:110px;bottom:481px;letter-spacing:0.02px;}
#tv_644{left:110px;bottom:436px;letter-spacing:0.03px;}
#tw_644{left:110px;bottom:412px;letter-spacing:-0.02px;word-spacing:0.64px;}
#tx_644{left:110px;bottom:392px;letter-spacing:-0.02px;word-spacing:0.03px;}
#ty_644{left:325px;bottom:392px;letter-spacing:0.12px;}
#tz_644{left:378px;bottom:392px;}
#t10_644{left:136px;bottom:366px;letter-spacing:-0.01px;}
#t11_644{left:175px;bottom:366px;letter-spacing:-0.01px;}
#t12_644{left:227px;bottom:366px;}
#t13_644{left:240px;bottom:366px;letter-spacing:-0.01px;}
#t14_644{left:285px;bottom:366px;}
#t15_644{left:292px;bottom:366px;letter-spacing:-0.01px;}
#t16_644{left:396px;bottom:366px;letter-spacing:-0.01px;}
#t17_644{left:110px;bottom:339px;letter-spacing:-0.01px;word-spacing:0.71px;}
#t18_644{left:110px;bottom:319px;letter-spacing:0.02px;word-spacing:2.24px;}
#t19_644{left:264px;bottom:319px;letter-spacing:0.12px;}
#t1a_644{left:392px;bottom:319px;letter-spacing:-0.01px;word-spacing:2.27px;}
#t1b_644{left:110px;bottom:299px;letter-spacing:-0.01px;word-spacing:2.39px;}
#t1c_644{left:110px;bottom:280px;word-spacing:0.79px;}
#t1d_644{left:110px;bottom:261px;letter-spacing:0.01px;word-spacing:1.02px;}
#t1e_644{left:110px;bottom:242px;letter-spacing:0.02px;}
#t1f_644{left:170px;bottom:250px;}
#t1g_644{left:136px;bottom:216px;letter-spacing:-0.01px;}
#t1h_644{left:175px;bottom:216px;letter-spacing:-0.01px;}
#t1i_644{left:227px;bottom:216px;}
#t1j_644{left:240px;bottom:216px;letter-spacing:-0.01px;}
#t1k_644{left:285px;bottom:216px;}
#t1l_644{left:292px;bottom:216px;letter-spacing:-0.01px;}
#t1m_644{left:396px;bottom:216px;letter-spacing:-0.01px;}
#t1n_644{left:110px;bottom:59px;letter-spacing:-0.08px;}
#t1o_644{left:141px;bottom:59px;}
#t1p_644{left:157px;bottom:59px;letter-spacing:-0.08px;}

.s1_644{font-size:11px;font-family:MinionPro-Regular_7yv;color:#000;}
.s2_644{font-size:12px;font-family:MinionPro-Regular_7yv;color:#000;}
.s3_644{font-size:12px;font-family:UbuntuMono-Regular_7zr;color:#000;}
.s4_644{font-size:16px;font-family:MinionPro-Regular_7yv;color:#000;}
.s5_644{font-size:24px;font-family:MyriadPro-SemiboldCond_7yc;color:#000;}
.s6_644{font-size:15px;font-family:UbuntuMono-Regular_7zr;color:#000;}
.s7_644{font-size:13px;font-family:UbuntuMono-Bold_7zh;color:#069;}
.s8_644{font-size:13px;font-family:UbuntuMono-Regular_7zr;color:#008;}
.s9_644{font-size:13px;font-family:UbuntuMono-Regular_7zr;color:#555;}
.sa_644{font-size:13px;font-family:UbuntuMono-Regular_7zr;color:#000;}
.sb_644{font-size:13px;font-family:UbuntuMono-Regular_7zr;color:#C30;}
.sc_644{font-size:9px;font-family:MinionPro-Regular_7yv;color:#000;}
.sd_644{font-size:14px;font-family:MyriadPro-SemiboldCond_7yc;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts644" type="text/css" >

@font-face {
	font-family: MinionPro-Regular_7yv;
	src: url("fonts/MinionPro-Regular_7yv.woff") format("woff");
}

@font-face {
	font-family: MyriadPro-SemiboldCond_7yc;
	src: url("fonts/MyriadPro-SemiboldCond_7yc.woff") format("woff");
}

@font-face {
	font-family: UbuntuMono-Bold_7zh;
	src: url("fonts/UbuntuMono-Bold_7zh.woff") format("woff");
}

@font-face {
	font-family: UbuntuMono-Regular_7zr;
	src: url("fonts/UbuntuMono-Regular_7zr.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg644Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg644" style="-webkit-user-select: none;"><svg id="pdf644" width="770" height="1010" viewBox="0 0 770 1010" style="width:770px; height:1010px; -moz-transform:scale(1); z-index: 0; isolation: isolate;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<defs>
<clipPath id="c0_644"><path d="M110,930.3v-4.7H660v4.7Z"/></clipPath>
<clipPath id="c1_644"><path d="M110,847.3v-5.1H247.5v5.1Z"/></clipPath>
<style type="text/css"><![CDATA[
.g0_644{
fill: none;
stroke: #000;
stroke-width: 0.381;
stroke-linecap: round;
stroke-miterlimit: 10;
}
.g1_644{
fill: none;
stroke: #000;
stroke-width: 0.763;
stroke-linecap: round;
stroke-miterlimit: 10;
}
]]></style>
</defs>
<path clip-path="url(#c0_644)" d="M660,927.9H110" class="g0_644"/>
<path clip-path="url(#c1_644)" d="M110,844.7H247.5" class="g1_644"/>
</svg></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_644" class="t s1_644">2 </span><span id="t2_644" class="t s2_644">It is often cleaner and simpler to define the worker code in a separate file. But this trick of having two threads </span>
<span id="t3_644" class="t s2_644">run different sections of the same file blew my mind when I first encountered it for the Unix </span><span id="t4_644" class="t s3_644">fork() </span><span id="t5_644" class="t s2_644">system </span>
<span id="t6_644" class="t s2_644">call. And I think it is worth demonstrating this technique simply for its strange elegance. </span>
<span id="t7_644" class="t s4_644">• </span><span id="t8_644" class="t s4_644">Even if your application is not using the full power of one CPU, you may still </span>
<span id="t9_644" class="t s4_644">want to use threads to maintain the responsiveness of the main thread. Consider </span>
<span id="ta_644" class="t s4_644">a server that handles large but relatively infrequent requests. Suppose it gets only </span>
<span id="tb_644" class="t s4_644">one request a second, but needs to spend about half a second of (blocking CPU- </span>
<span id="tc_644" class="t s4_644">bound) computation to process each request. On average, it will be idle 50% of </span>
<span id="td_644" class="t s4_644">the time. But when two requests arrive within a few milliseconds of each other, </span>
<span id="te_644" class="t s4_644">the server will not even be able to begin a response to the second request until the </span>
<span id="tf_644" class="t s4_644">computation of the first response is complete. Instead, if the server uses a worker </span>
<span id="tg_644" class="t s4_644">thread to perform the computation, the server can begin the response to both </span>
<span id="th_644" class="t s4_644">requests immediately and provide a better experience for the server’s clients. </span>
<span id="ti_644" class="t s4_644">Assuming the server has more than one CPU core, it can also compute the body </span>
<span id="tj_644" class="t s4_644">of both responses in parallel, but even if there is only a single core, using workers </span>
<span id="tk_644" class="t s4_644">still improves the responsiveness. </span>
<span id="tl_644" class="t s4_644">• </span><span id="tm_644" class="t s4_644">In general, workers allow us to turn blocking synchronous operations into non‐ </span>
<span id="tn_644" class="t s4_644">blocking asynchronous operations. If you are writing a program that depends on </span>
<span id="to_644" class="t s4_644">legacy code that is unavoidably synchronous, you may be able to use workers to </span>
<span id="tp_644" class="t s4_644">avoid blocking when you need to call that legacy code. </span>
<span id="tq_644" class="t s4_644">Worker threads are not nearly as heavyweight as child processes, but they are not </span>
<span id="tr_644" class="t s4_644">lightweight. It does not generally make sense to create a worker unless you have sig‐ </span>
<span id="ts_644" class="t s4_644">nificant work for it to do. And, generally speaking, if your program is not CPU- </span>
<span id="tt_644" class="t s4_644">bound and is not having responsiveness problems, then you probably do not need </span>
<span id="tu_644" class="t s4_644">worker threads. </span>
<span id="tv_644" class="t s5_644">16.11.1 Creating Workers and Passing Messages </span>
<span id="tw_644" class="t s4_644">The Node module that defines workers is known as “worker_threads.” In this section </span>
<span id="tx_644" class="t s4_644">we’ll refer to it with the identifier </span><span id="ty_644" class="t s6_644">threads</span><span id="tz_644" class="t s4_644">: </span>
<span id="t10_644" class="t s7_644">const </span><span id="t11_644" class="t s8_644">threads </span><span id="t12_644" class="t s9_644">= </span><span id="t13_644" class="t s8_644">require</span><span id="t14_644" class="t sa_644">(</span><span id="t15_644" class="t sb_644">"worker_threads"</span><span id="t16_644" class="t sa_644">); </span>
<span id="t17_644" class="t s4_644">This module defines a Worker class to represent a worker thread, and you can create </span>
<span id="t18_644" class="t s4_644">a new thread with the </span><span id="t19_644" class="t s6_644">threads.Worker() </span><span id="t1a_644" class="t s4_644">constructor. The following code demon‐ </span>
<span id="t1b_644" class="t s4_644">strates using this constructor to create a worker, and shows how to pass messages </span>
<span id="t1c_644" class="t s4_644">from main thread to worker and from worker to main thread. It also demonstrates a </span>
<span id="t1d_644" class="t s4_644">trick that allows you to put the main thread code and the worker thread code in the </span>
<span id="t1e_644" class="t s4_644">same file. </span>
<span id="t1f_644" class="t sc_644">2 </span>
<span id="t1g_644" class="t s7_644">const </span><span id="t1h_644" class="t s8_644">threads </span><span id="t1i_644" class="t s9_644">= </span><span id="t1j_644" class="t s8_644">require</span><span id="t1k_644" class="t sa_644">(</span><span id="t1l_644" class="t sb_644">"worker_threads"</span><span id="t1m_644" class="t sa_644">); </span>
<span id="t1n_644" class="t sd_644">626 </span><span id="t1o_644" class="t sd_644">| </span><span id="t1p_644" class="t sd_644">Chapter 16: Server-Side JavaScript with Node </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
